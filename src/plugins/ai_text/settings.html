<div class="form-group">
  <button type="button" id="generateBtn" class="form-input">Generate Quote</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('generateBtn');

    // Try to infer pluginId from the page; if your base template exposes a different
    // variable, replace pluginId below accordingly.
    const pluginId = (window.pluginId || (window.pluginSettings && window.pluginSettings.id));
    // Fallback: derive from URL (/plugins/<pluginId>/settings)
    const urlParts = location.pathname.split('/').filter(Boolean);
    const urlPluginId = urlParts.includes('plugins') ? urlParts[urlParts.indexOf('plugins') + 1] : null;
    const resolvedPluginId = pluginId || urlPluginId;

    btn.addEventListener('click', async () => {
      btn.disabled = true;
      const original = btn.textContent;
      btn.textContent = 'Generatingâ€¦';

      try {
        // Adjust this path to match your manual-update route if different:
        const res = await fetch(`/plugins/manual-update/${resolvedPluginId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            plugin_id: resolvedPluginId,
            plugin_settings: {},  // you can pass overrides if you want
          })
        });
        if (!res.ok) {
          const msg = await res.text();
          throw new Error(msg || 'Request failed');
        }
        // Optional: reload preview or show a toast
        location.reload(); // reloads to show the new quote image
      } catch (err) {
        alert('Failed to generate quote: ' + (err?.message || err));
      } finally {
        btn.disabled = false;
        btn.textContent = original;
      }
    });
  });
</script>