<div class="form-group">
  <button type="button" id="generateBtn" class="form-input">Generate Quote</button>
</div>

<script>
  // Find the existing "Update Now" control that your app renders
  function findUpdateNowButton() {
    // try common selectors first
    const candidates = [
      '#update-now',
      'button.update-now',
      '[data-action="update-now"]',
      'button[name="update"]',
      'input[type="submit"].update-now'
    ];
    for (const sel of candidates) {
      const el = document.querySelector(sel);
      if (el) return el;
    }
    // fallback: match by visible text
    const btns = Array.from(document.querySelectorAll('button, input[type="submit"]'));
    return btns.find(b => (b.textContent || b.value || '').trim().toLowerCase() === 'update now') || null;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const genBtn = document.getElementById('generateBtn');

    genBtn.addEventListener('click', async () => {
      const original = genBtn.textContent;
      genBtn.disabled = true;
      genBtn.textContent = 'Generatingâ€¦';

      try {
        const updateBtn = findUpdateNowButton();
        if (updateBtn) {
          // Let the existing form/route do its job
          updateBtn.click();
          return;
        }

        // LAST-RESORT fallback: post the same form programmatically
        const form = document.querySelector('form[action]');
        if (form && form.action) {
          const fd = new FormData(form);
          const res = await fetch(form.action, { method: form.method || 'POST', body: fd });
          if (res.ok) location.reload();
          else throw new Error(await res.text());
        } else {
          throw new Error('Could not find the Update Now form on this page.');
        }
      } catch (err) {
        alert('Failed to generate quote: ' + (err?.message || err));
        genBtn.disabled = false;
        genBtn.textContent = original;
      }
    });
  });
</script>